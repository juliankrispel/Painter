<html ng-app="app">
  <body ng-controller="test">
    <input type="text" ng-model="sideA"/>
    <input type="text" ng-model="sideB"/>
    <script src="../bower_components/underscore/underscore-min.js"></script>
    <script src="../bower_components/angular/angular.min.js"></script>
    <script src="../js/msgpass.js"></script>
    <script>
      ps = new PublishSubscriber;

      angular.module('app', []);

      angular.module('app').controller('test', function($scope){


        ps.subscribe('TEST', 'A', function(a){
          console.log('sideA changed', a);  
        });

        // When setValue is called the above callback should be fired
        ps.setValue('TEST', 'A', 'HELLO');

        $scope.sideA = ps.getValue('TEST');
        $scope.sideB = ps.getValue('TEST');

        $scope.$watch('sideA', function(a,b){
          console.log(a, b);
          ps.setValue('TEST', '', 'HELLO');
        });

      });
    </script>
  </body>
</html>
